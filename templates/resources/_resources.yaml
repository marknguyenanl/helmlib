{{/* {{ define "helmlib.usefamily"}} */}}
{{/* {{ .Value.overlay.usefamily }} */}}
{{/* {{ end }} */}}
{{/* {{ define "helmlib.usemachine"}} */}}
{{/* {{ .Value.overlay.usemachine }} */}}
{{/* {{ end }} */}}

{{ define "helmlib.machine" }}
{{ $root := . }}
{{ range $family := .Values.global.families }}
{{ if eq $family.name .usefamily }}
{{ range $machine := $root.Values.global.machines }}
{{ if eq $machine.name .usemachine }}
resources:
  requests:
    cpu: {{ $family.cpu }}m
    memory: {{ mul $family.memory $machine.memcpu }}Mi
  limits:
    cpu: {{ mul $family.cpu $machine.limitrequest }}m
    memory: {{ mul $family.memory $machine.memcpu $machine.limitrequest }}Mi
{{ end }}
{{ end }}
{{ end }}
{{ end }}
{{ end }}
