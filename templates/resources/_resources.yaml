{{/* {{ define "helmlib.usefamily"}} */}}
{{/* {{ .Value.overlay.usefamily }} */}}
{{/* {{ end }} */}}
{{/* {{ define "helmlib.usemachine"}} */}}
{{/* {{ .Value.overlay.usemachine }} */}}
{{/* {{ end }} */}}

{{ define "helmlib.machine" }}
{{ range $family := $.Values.global.families }}
{{ if eq $family.name (tpl $.Values.global.usefamily) }}
{{ range $machine := $.Values.global.machines }}
{{ if eq $machine.name (tpl $.Values.global.usemachine) }}
resources:
  requests:
    cpu: {{ $family.cpu }}m
    memory: {{ mul $family.memory $machine.memcpu }}Mi
  limits:
    cpu: {{ mul $family.cpu $machine.limitrequest }}m
    memory: {{ mul $family.memory $machine.memcpu $machine.limitrequest }}Mi
{{ end }}
{{ end }}
{{ end }}
{{ end }}
{{ end }}
